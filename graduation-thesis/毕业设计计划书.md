# 基于WebSocket的即时通讯系统设计与实现 - 毕业设计计划书

## 一、项目基本信息

**项目名称**：基于WebSocket的即时通讯系统设计与实现（Fleets）

**学生姓名**：苏恒

**学号**：2020214785

**指导教师**：[待填写]

**计划完成时间**：2025年6月

---

## 二、项目背景与意义

### 2.1 研究背景

随着移动互联网的快速发展，即时通讯已成为人们日常生活和工作中不可或缺的一部分。传统的HTTP轮询方式存在延迟高、资源消耗大等问题，而WebSocket协议的出现为实时通信提供了更优的解决方案。

### 2.2 研究意义

1. **技术意义**：探索WebSocket在高并发场景下的应用实践，研究分布式架构下的消息可靠性保障机制
2. **实用价值**：设计并实现一个功能完整、性能优良的即时通讯系统，可应用于企业内部沟通、在线客服等场景
3. **学习价值**：综合运用Spring Boot、WebSocket、消息队列、分布式缓存等主流技术栈

---

## 三、项目目标与功能需求

### 3.1 总体目标

设计并实现一个基于WebSocket的分布式即时通讯系统，支持单聊、群聊、文件传输等核心功能，并保证消息的可靠传输和系统的高可用性。

### 3.2 功能需求

#### 3.2.1 用户管理模块
- 用户注册与登录（JWT认证）
- 用户信息管理（头像、昵称、个性签名）
- 密码修改与找回
- 用户搜索与添加

#### 3.2.2 好友管理模块
- 好友添加与删除
- 好友列表查看
- 好友备注设置
- 好友拉黑功能

#### 3.2.3 群组管理模块
- 群组创建与解散
- 群成员管理（邀请、踢出、退出）
- 群信息设置（群名、群公告）
- 群权限管理（群主、管理员）

#### 3.2.4 消息通信模块
- 单聊消息发送与接收
- 群聊消息发送与接收
- 消息类型支持（文本、图片、文件、语音）
- 消息撤回功能
- 消息已读回执
- 离线消息推送

#### 3.2.5 文件传输模块
- 文件上传与下载
- 图片预览
- 文件元数据管理

#### 3.2.6 在线状态模块
- 用户在线状态管理
- 心跳检测机制
- 多端登录支持

### 3.3 非功能需求

- **性能要求**：支持10000+并发在线用户，消息延迟<100ms
- **可靠性**：消息送达率>99.9%，支持消息重试机制
- **可用性**：系统可用性>99%，支持服务降级
- **安全性**：数据传输加密，防止SQL注入、XSS攻击
- **可扩展性**：采用微服务架构，支持水平扩展

---

## 四、技术方案

### 4.1 技术栈选型

#### 4.1.1 后端技术
- **开发框架**：Spring Boot 2.7.x
- **WebSocket**：Spring WebSocket + STOMP协议
- **数据库**：MySQL 8.0（关系型数据）+ MongoDB 4.4（消息存储）
- **缓存**：Redis 6.2（分布式缓存）
- **消息队列**：RocketMQ 4.9（异步消息处理）
- **网关**：OpenResty（接口限流、负载均衡）
- **认证**：JWT（JSON Web Token）
- **ORM框架**：MyBatis Plus

#### 4.1.2 前端技术
- **框架**：Vue 3 + TypeScript
- **UI组件库**：Element Plus
- **状态管理**：Pinia
- **WebSocket客户端**：SockJS + STOMP.js
- **构建工具**：Vite

#### 4.1.3 开发工具
- **IDE**：IntelliJ IDEA / VS Code
- **版本控制**：Git
- **容器化**：Docker + Docker Compose
- **接口测试**：Postman
- **性能测试**：JMeter

### 4.2 系统架构设计

#### 4.2.1 总体架构
```
┌─────────────┐
│  Web前端    │
└──────┬──────┘
       │ WebSocket/HTTP
┌──────▼──────────────────────────┐
│      OpenResty网关              │
│  (限流、负载均衡、静态资源)      │
└──────┬──────────────────────────┘
       │
┌──────▼──────────────────────────┐
│    Spring Boot应用层            │
│  ┌──────────┬──────────────┐   │
│  │ 用户模块  │  好友模块    │   │
│  ├──────────┼──────────────┤   │
│  │ 群组模块  │  消息模块    │   │
│  ├──────────┼──────────────┤   │
│  │ 文件模块  │  连接模块    │   │
│  └──────────┴──────────────┘   │
└──────┬──────────────────────────┘
       │
┌──────▼──────────────────────────┐
│         中间件层                 │
│  ┌─────────┬─────────┬────────┐ │
│  │  MySQL  │  Redis  │ RocketMQ│ │
│  └─────────┴─────────┴────────┘ │
│  ┌─────────────────────────────┐│
│  │        MongoDB              ││
│  └─────────────────────────────┘│
└──────────────────────────────────┘
```

#### 4.2.2 数据库设计

**MySQL（关系型数据）**
- user（用户表）
- friendship（好友关系表）
- group_info（群组信息表）
- group_member（群成员表）
- conversation（会话表）

**MongoDB（消息存储）**
- message（消息表）
- offline_messages（离线消息表）
- group_messages（群消息表）
- media_metadata（媒体元数据表）

**Redis（缓存）**
- 用户信息缓存
- 好友列表缓存
- 群组信息缓存
- 在线状态缓存
- 会话列表缓存

### 4.3 核心技术实现

#### 4.3.1 WebSocket连接管理
- 基于Spring WebSocket实现长连接
- 使用STOMP协议进行消息路由
- 实现心跳检测机制（30秒间隔）
- 支持断线重连

#### 4.3.2 消息可靠性保障
- **消息ACK机制**：三态确认（发送、送达、已读）
- **离线消息**：存储到MongoDB，上线后推送
- **消息重试**：失败消息自动重试3次
- **消息去重**：基于消息ID去重

#### 4.3.3 分布式ID生成
- 采用雪花算法（Snowflake）
- 保证ID全局唯一且递增
- 支持多机房部署

#### 4.3.4 缓存策略
- **多级缓存**：本地缓存 + Redis分布式缓存
- **缓存更新**：写操作同步更新缓存
- **缓存穿透**：布隆过滤器
- **缓存雪崩**：随机过期时间

#### 4.3.5 消息队列应用
- **异步解耦**：消息发送异步化
- **削峰填谷**：应对突发流量
- **消息持久化**：保证消息不丢失

---

## 五、实施计划

### 5.1 时间安排（2025年1月 - 2025年6月）

#### 第一阶段：需求分析与设计（1月 - 2月初，4周）

**第1-2周（1月1日 - 1月14日）**
- 完成需求调研与分析
- 编写需求规格说明书
- 确定技术方案

**第3-4周（1月15日 - 1月31日）**
- 完成系统架构设计
- 完成数据库设计
- 完成接口设计文档

**交付物**：
- 需求规格说明书
- 系统架构设计文档
- 数据库设计文档
- 接口设计文档

---

#### 第二阶段：后端核心功能开发（2月 - 3月，8周）

**第5-6周（2月1日 - 2月14日）**
- 搭建项目基础框架
- 配置开发环境（Docker Compose）
- 实现用户注册登录功能
- 实现JWT认证机制

**第7-8周（2月15日 - 2月28日）**
- 实现好友管理功能
- 实现用户信息管理
- 编写单元测试

**第9-10周（3月1日 - 3月14日）**
- 实现WebSocket连接管理
- 实现单聊消息功能
- 实现消息ACK机制
- 实现离线消息功能

**第11-12周（3月15日 - 3月31日）**
- 实现群组管理功能
- 实现群聊消息功能
- 实现文件上传下载功能

**交付物**：
- 后端核心功能代码
- 单元测试代码
- API接口文档

---

#### 第三阶段：前端开发（4月，4周）

**第13-14周（4月1日 - 4月14日）**
- 搭建前端项目框架
- 实现登录注册页面
- 实现主界面布局
- 实现好友列表页面

**第15-16周（4月15日 - 4月30日）**
- 实现聊天界面
- 实现WebSocket连接
- 实现消息发送接收
- 实现文件上传预览

**交付物**：
- 前端完整代码
- 前端使用说明

---

#### 第四阶段：系统测试与优化（5月1日 - 5月20日，3周）

**第17周（5月1日 - 5月7日）**
- 功能测试（黑盒测试）
- 集成测试
- Bug修复

**第18周（5月8日 - 5月14日）**
- 性能测试（JMeter压测）
- 性能优化（SQL优化、缓存优化）
- 安全测试

**第19周（5月15日 - 5月20日）**
- 系统部署测试
- 用户体验优化
- 最终Bug修复

**交付物**：
- 测试报告
- 性能测试报告
- 部署文档

---

#### 第五阶段：论文撰写（5月21日 - 6月10日，3周）

**第20周（5月21日 - 5月27日）**
- 撰写论文第1-3章
  - 第1章：绪论
  - 第2章：相关技术介绍
  - 第3章：系统需求分析

**第21周（5月28日 - 6月3日）**
- 撰写论文第4-5章
  - 第4章：系统设计
  - 第5章：系统实现

**第22周（6月4日 - 6月10日）**
- 撰写论文第6-7章
  - 第6章：系统测试与性能分析
  - 第7章：总结与展望
- 论文格式调整
- 论文查重与修改

**交付物**：
- 毕业论文初稿
- 毕业论文终稿

---

#### 第六阶段：答辩准备（6月11日 - 6月20日，1.5周）

**第23周（6月11日 - 6月17日）**
- 制作答辩PPT
- 录制系统演示视频
- 准备答辩讲稿

**第24周（6月18日 - 6月20日）**
- 答辩预演
- 准备答辩问题
- 最终检查

**交付物**：
- 答辩PPT
- 演示视频
- 答辩讲稿

---

### 5.2 进度甘特图

```
时间轴        1月    2月    3月    4月    5月    6月
─────────────────────────────────────────────
需求设计      ████
后端开发            ████████
前端开发                    ████
测试优化                        ████
论文撰写                            ████
答辩准备                                ██
```

---

## 六、重点研究内容

### 6.1 研究重点一：基于WebSocket的实时通信机制

**研究内容**：
- WebSocket连接的建立与维护
- 心跳检测与断线重连机制
- 多端登录的连接管理策略

**预期成果**：
- 实现稳定的WebSocket长连接
- 连接断开后自动重连成功率>95%
- 支持同一用户多端同时在线

### 6.2 研究重点二：分布式环境下的消息可靠性保障

**研究内容**：
- 消息ACK确认机制设计
- 离线消息的存储与推送策略
- 消息重试与去重机制
- 消息顺序性保证

**预期成果**：
- 消息送达率>99.9%
- 离线消息推送成功率>99%
- 消息顺序准确率100%

**对比实验**：
- 对比有无ACK机制的消息送达率
- 对比不同存储方案（MySQL vs MongoDB）的性能

### 6.3 研究重点三：高并发场景下的性能优化

**研究内容**：
- 多级缓存策略设计
- 数据库查询优化（索引、分表）
- 消息队列削峰填谷
- 接口限流与降级策略

**预期成果**：
- 支持10000+并发在线用户
- 消息发送延迟<100ms
- 系统QPS>5000

**性能测试**：
- 使用JMeter进行压力测试
- 测试不同并发量下的系统表现
- 绘制性能曲线图

---

## 七、预期成果

### 7.1 系统成果

1. **完整的即时通讯系统**
   - 功能完整的后端服务
   - 用户友好的Web前端
   - 完善的部署文档

2. **技术文档**
   - 系统架构设计文档
   - 数据库设计文档
   - API接口文档
   - 部署运维文档

3. **测试报告**
   - 功能测试报告
   - 性能测试报告
   - 安全测试报告

### 7.2 论文成果

**论文题目**：基于WebSocket的即时通讯系统设计与实现

**论文结构**：
- 第1章：绪论（研究背景、意义、内容）
- 第2章：相关技术介绍（WebSocket、Spring Boot、消息队列等）
- 第3章：系统需求分析（功能需求、非功能需求）
- 第4章：系统设计（架构设计、数据库设计、接口设计）
- 第5章：系统实现（核心功能实现、关键代码）
- 第6章：系统测试与性能分析（功能测试、性能测试、对比实验）
- 第7章：总结与展望

**预期字数**：2万字以上

### 7.3 创新点

1. **消息可靠性保障机制**：设计了完整的消息ACK确认机制，保证消息可靠送达
2. **混合存储方案**：结合MySQL和MongoDB的优势，实现高效的数据存储
3. **多级缓存策略**：设计了本地缓存+Redis的多级缓存，提升系统性能
4. **分布式ID生成**：基于雪花算法实现全局唯一ID生成

---

## 八、风险分析与应对

### 8.1 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| WebSocket连接不稳定 | 高 | 中 | 实现心跳检测和断线重连机制 |
| 高并发性能瓶颈 | 高 | 中 | 引入缓存和消息队列，进行性能优化 |
| 消息丢失 | 高 | 低 | 实现消息ACK和重试机制 |
| 数据库性能问题 | 中 | 中 | 优化索引，考虑分库分表 |

### 8.2 进度风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| 开发进度延期 | 高 | 中 | 预留缓冲时间，优先实现核心功能 |
| 前端开发经验不足 | 中 | 中 | 提前学习Vue3，使用成熟UI组件库 |
| 测试时间不足 | 中 | 低 | 开发过程中同步进行单元测试 |

### 8.3 其他风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| 需求变更 | 中 | 低 | 做好需求确认，控制需求变更 |
| 硬件资源不足 | 低 | 低 | 使用云服务器或Docker容器 |

---

## 九、参考资料

### 9.1 技术文档
1. Spring Boot官方文档：https://spring.io/projects/spring-boot
2. WebSocket协议规范：RFC 6455
3. Redis官方文档：https://redis.io/documentation
4. MongoDB官方文档：https://docs.mongodb.com/
5. RocketMQ官方文档：https://rocketmq.apache.org/

### 9.2 参考论文
1. 基于WebSocket的实时通信系统设计与实现
2. 分布式即时通讯系统的消息可靠性研究
3. 高并发场景下的缓存优化策略研究

### 9.3 参考书籍
1. 《Spring Boot实战》
2. 《深入理解Java虚拟机》
3. 《Redis设计与实现》
4. 《高性能MySQL》

---

## 十、总结

本项目旨在设计并实现一个基于WebSocket的分布式即时通讯系统，综合运用Spring Boot、WebSocket、消息队列、分布式缓存等主流技术。项目具有以下特点：

1. **技术栈完整**：涵盖前后端、数据库、缓存、消息队列等多个技术领域
2. **架构合理**：采用分层架构和微服务思想，易于扩展和维护
3. **功能完善**：实现了即时通讯系统的核心功能
4. **有研究深度**：重点研究消息可靠性和高并发性能优化
5. **工作量充足**：包含需求分析、系统设计、编码实现、测试优化、论文撰写等完整流程

通过本项目的实施，将深入理解分布式系统的设计与实现，掌握WebSocket实时通信技术，提升系统架构设计和性能优化能力，为今后从事相关工作打下坚实基础。

---

**制定日期**：2025年1月

**预计完成日期**：2025年6月

**学生签名**：___________

**指导教师签名**：___________
